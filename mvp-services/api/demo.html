<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BvckZ MVP - Demo</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #2563eb;
            text-align: center;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        input, textarea, button, select {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            background: #2563eb;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #1d4ed8;
        }
        .success {
            background: #10b981;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error {
            background: #ef4444;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .card {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: border-color 0.3s;
        }
        .card:hover {
            border-color: #2563eb;
        }
        .card.selected {
            border-color: #2563eb;
            background: #f0f8ff;
        }
        .preview {
            width: 100%;
            height: 150px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .center { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .left { background: linear-gradient(135deg, #6b7280, #4b5563); }
        .right { background: linear-gradient(135deg, #f59e0b, #d97706); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåü BvckZ MVP Demo</h1>
        <p style="text-align: center;">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MVP —Å–µ—Ä–≤–∏—Å–∞ –∞–ø—Å–∞–π–∫–ª–∞ –æ–¥–µ–∂–¥—ã</p>
        
        <div id="message"></div>

        <div class="section">
            <h3>1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –í—Ö–æ–¥</h3>
            <input type="email" id="email" placeholder="Email" value="test@bvckz.com">
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" value="password123">
            <input type="text" id="fullName" placeholder="–ü–æ–ª–Ω–æ–µ –∏–º—è" value="Test User">
            
            <div style="display: flex; gap: 10px;">
                <button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                <button onclick="login()">–í–æ–π—Ç–∏</button>
                <button onclick="getProfile()">–ü—Ä–æ—Ñ–∏–ª—å</button>
            </div>
        </div>

        <div class="section">
            <h3>2. 3D –î–∏–∑–∞–π–Ω–µ—Ä (–î–µ–º–æ)</h3>
            <div class="grid">
                <div class="card" onclick="selectCard('left')" id="leftCard">
                    <div class="preview left">–õ–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞</div>
                    <select id="leftDesign">
                        <option value="">–ë–µ–∑ –¥–∏–∑–∞–π–Ω–∞</option>
                        <option value="logo">–õ–æ–≥–æ—Ç–∏–ø</option>
                        <option value="pattern">–£–∑–æ—Ä</option>
                    </select>
                </div>
                
                <div class="card selected" onclick="selectCard('center')" id="centerCard">
                    <div class="preview center">–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞</div>
                    <select id="centerColor">
                        <option value="blue">–°–∏–Ω–∏–π</option>
                        <option value="green">–ó–µ–ª—ë–Ω—ã–π</option>
                        <option value="red">–ö—Ä–∞—Å–Ω—ã–π</option>
                        <option value="black">–ß—ë—Ä–Ω—ã–π</option>
                    </select>
                </div>
                
                <div class="card" onclick="selectCard('right')" id="rightCard">
                    <div class="preview right">–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –æ—Ä–Ω–∞–º–µ–Ω—Ç</div>
                    <select id="rightPattern">
                        <option value="">–ë–µ–∑ –æ—Ä–Ω–∞–º–µ–Ω—Ç–∞</option>
                        <option value="kazakh">–ö–∞–∑–∞—Ö—Å–∫–∏–π</option>
                        <option value="uzbek">–£–∑–±–µ–∫—Å–∫–∏–π</option>
                        <option value="kyrgyz">–ö–∏—Ä–≥–∏–∑—Å–∫–∏–π</option>
                    </select>
                </div>
            </div>
            
            <button onclick="saveDesign()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∏–∑–∞–π–Ω</button>
        </div>

        <div class="section">
            <h3>3. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏</h3>
            <select id="itemsCount">
                <option value="3">3-4 —Ñ—É—Ç–±–æ–ª–∫–∏</option>
                <option value="5" selected>5-6 —Ñ—É—Ç–±–æ–ª–æ–∫</option>
                <option value="7">7+ —Ñ—É—Ç–±–æ–ª–æ–∫</option>
            </select>
            
            <select id="pickupMethod">
                <option value="courier">–ö—É—Ä—å–µ—Ä</option>
                <option value="drop_point">–ü—É–Ω–∫—Ç –ø—Ä–∏—ë–º–∞</option>
            </select>
            
            <textarea id="pickupAddress" placeholder="–ê–¥—Ä–µ—Å –¥–ª—è –∫—É—Ä—å–µ—Ä–∞" rows="3">–ê–ª–º–∞—Ç—ã, —É–ª. –ê–±–∞—è 123, –∫–≤. 45</textarea>
            <textarea id="notes" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏" rows="2">–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞ —á–µ—Ä–µ–∑ –¥–µ–º–æ</textarea>
            
            <div style="display: flex; gap: 10px;">
                <button onclick="createDonation()">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
                <button onclick="getDonations()">–ú–æ–∏ –∑–∞—è–≤–∫–∏</button>
            </div>
        </div>

        <div class="section">
            <h3>4. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
            <button onclick="createOrder()">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å —Ç–µ–∫—É—â–∏–º –¥–∏–∑–∞–π–Ω–æ–º</button>
            <button onclick="getOrders()">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</button>
        </div>

        <div class="section">
            <h3>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h3>
            <div style="display: flex; gap: 10px;">
                <button onclick="checkHealth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API</button>
                <button onclick="checkServices()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã</button>
            </div>
            <div id="services-status"></div>
        </div>
    </div>

    <script>
        let authToken = localStorage.getItem('bvckz_token');
        let selectedCardType = 'center';
        const API_BASE = 'http://localhost:8000/api';
        
        function showMessage(text, isError = false) {
            const div = document.getElementById('message');
            div.innerHTML = `<div class="${isError ? 'error' : 'success'}">${text}</div>`;
            setTimeout(() => div.innerHTML = '', 5000);
        }

        function selectCard(type) {
            selectedCardType = type;
            document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
            document.getElementById(type + 'Card').classList.add('selected');
        }

        async function register() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const fullName = document.getElementById('fullName').value;
            
            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({email, password, full_name: fullName})
                });
                
                const data = await response.json();
                if (response.ok) {
                    authToken = data.access_token;
                    localStorage.setItem('bvckz_token', authToken);
                    showMessage(`‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–æ–∫–µ–Ω: ${authToken.slice(0, 20)}...`);
                } else {
                    showMessage(`‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${data.detail}`, true);
                }
            } catch (error) {
                showMessage(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({email, password})
                });
                
                const data = await response.json();
                if (response.ok) {
                    authToken = data.access_token;
                    localStorage.setItem('bvckz_token', authToken);
                    showMessage(`‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω! –¢–æ–∫–µ–Ω: ${authToken.slice(0, 20)}...`);
                } else {
                    showMessage(`‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${data.detail}`, true);
                }
            } catch (error) {
                showMessage(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        async function getProfile() {
            if (!authToken) {
                showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', true);
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/users/me`, {
                    headers: {'Authorization': `Bearer ${authToken}`}
                });
                
                const data = await response.json();
                if (response.ok) {
                    showMessage(`‚úÖ –ü—Ä–æ—Ñ–∏–ª—å: ${data.full_name} (${data.email}) - ${data.role || 'user'}`);
                } else {
                    showMessage(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è: ${data.detail}`, true);
                }
            } catch (error) {
                showMessage(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        async function createDonation() {
            if (!authToken) {
                showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', true);
                return;
            }
            
            const itemsCount = parseInt(document.getElementById('itemsCount').value);
            const pickupMethod = document.getElementById('pickupMethod').value;
            const pickupAddress = document.getElementById('pickupAddress').value;
            const notes = document.getElementById('notes').value;
            
            try {
                const response = await fetch(`${API_BASE}/donations`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        items_count: itemsCount,
                        pickup_method: pickupMethod,
                        pickup_address: pickupAddress,
                        notes
                    })
                });
                
                const data = await response.json();
                if (response.ok) {
                    showMessage(`‚úÖ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞! ID: ${data.id}, —Å—Ç–∞—Ç—É—Å: ${data.status}`);
                } else {
                    showMessage(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏: ${data.detail}`, true);
                }
            } catch (error) {
                showMessage(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        async function getDonations() {
            if (!authToken) {
                showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', true);
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/donations`, {
                    headers: {'Authorization': `Bearer ${authToken}`}
                });
                
                const data = await response.json();
                if (response.ok) {
                    const donationsText = data.map(d => 
                        `ID: ${d.id}, —Å—Ç–∞—Ç—É—Å: ${d.status}, –≤–µ—â–µ–π: ${d.items_count}, –º–µ—Ç–æ–¥: ${d.pickup_method}`
                    ).join('<br>');
                    showMessage(`‚úÖ –í–∞—à–∏ –∑–∞—è–≤–∫–∏:<br>${donationsText || '–ù–µ—Ç –∑–∞—è–≤–æ–∫'}`);
                } else {
                    showMessage(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞—è–≤–æ–∫: ${data.detail}`, true);
                }
            } catch (error) {
                showMessage(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        async function saveDesign() {
            const design = {
                left: document.getElementById('leftDesign').value,
                center: { color: document.getElementById('centerColor').value },
                right: document.getElementById('rightPattern').value
            };
            
            localStorage.setItem('bvckz_design', JSON.stringify(design));
            
            // Generate preview via media service
            if (authToken) {
                try {
                    const response = await fetch(`${API_BASE}/media/render`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify(JSON.stringify(design))
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        showMessage(`‚úÖ –î–∏–∑–∞–π–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω –∏ –ø—Ä–µ–≤—å—é —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ! URL: ${data.preview_url}`);
                        
                        // Update visual preview if possible
                        updateVisualPreview(design);
                    } else {
                        showMessage(`‚úÖ –î–∏–∑–∞–π–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω –ª–æ–∫–∞–ª—å–Ω–æ: ${JSON.stringify(design)}`);
                    }
                } catch (error) {
                    showMessage(`‚úÖ –î–∏–∑–∞–π–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω –ª–æ–∫–∞–ª—å–Ω–æ: ${JSON.stringify(design)}`);
                }
            } else {
                showMessage(`‚úÖ –î–∏–∑–∞–π–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω: ${JSON.stringify(design)}`);
            }
        }

        function updateVisualPreview(design) {
            // Update colors based on design
            const colors = {
                'blue': 'linear-gradient(135deg, #3b82f6, #1d4ed8)',
                'green': 'linear-gradient(135deg, #22c55e, #16a34a)', 
                'red': 'linear-gradient(135deg, #ef4444, #dc2626)',
                'black': 'linear-gradient(135deg, #1f2937, #111827)'
            };
            
            const centerPreview = document.querySelector('#centerCard .preview');
            if (centerPreview && colors[design.center?.color]) {
                centerPreview.style.background = colors[design.center.color];
            }
        }

        async function createOrder() {
            if (!authToken) {
                showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', true);
                return;
            }
            
            const design = {
                left: document.getElementById('leftDesign').value,
                center: { color: document.getElementById('centerColor').value },
                right: document.getElementById('rightPattern').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        design_metadata: JSON.stringify(design)
                    })
                });
                
                const data = await response.json();
                if (response.ok) {
                    showMessage(`‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω! ID: ${data.id}, —Å—Ç–∞—Ç—É—Å: ${data.status}`);
                } else {
                    showMessage(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞: ${data.detail}`, true);
                }
            } catch (error) {
                showMessage(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        async function getOrders() {
            if (!authToken) {
                showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', true);
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/orders`, {
                    headers: {'Authorization': `Bearer ${authToken}`}
                });
                
                const data = await response.json();
                if (response.ok) {
                    const ordersText = data.map(o => 
                        `ID: ${o.id}, —Å—Ç–∞—Ç—É—Å: ${o.status}, —Ü–µ–Ω–∞: ${o.total_price/100}‚ÇΩ`
                    ).join('<br>');
                    showMessage(`‚úÖ –í–∞—à–∏ –∑–∞–∫–∞–∑—ã:<br>${ordersText || '–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤'}`);
                } else {
                    showMessage(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤: ${data.detail}`, true);
                }
            } catch (error) {
                showMessage(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }

        async function checkHealth() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                if (response.ok) {
                    showMessage(`‚úÖ API –∑–¥–æ—Ä–æ–≤! –°—Ç–∞—Ç—É—Å: ${data.status}, –≤—Ä–µ–º—è: ${data.timestamp}`);
                } else {
                    showMessage(`‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω`, true);
                }
            } catch (error) {
                showMessage(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API: ${error.message}`, true);
            }
        }

        async function checkServices() {
            const services = [
                {name: 'API', url: 'http://localhost:8000/api/health'},
                {name: 'MinIO', url: 'http://localhost:9001'},
                {name: 'n8n', url: 'http://localhost:5678'},
                {name: 'Landing', url: 'http://localhost:3000'},
                {name: 'WebApp', url: 'http://localhost:3001'}
            ];
            
            let status = '<h4>–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤:</h4>';
            
            for (const service of services) {
                try {
                    const response = await fetch(service.url);
                    status += `‚úÖ ${service.name}: –†–∞–±–æ—Ç–∞–µ—Ç<br>`;
                } catch (error) {
                    status += `‚ùå ${service.name}: –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω<br>`;
                }
            }
            
            document.getElementById('services-status').innerHTML = status;
        }

        // Load saved design on page load
        window.addEventListener('load', () => {
            const savedDesign = localStorage.getItem('bvckz_design');
            if (savedDesign) {
                const design = JSON.parse(savedDesign);
                if (design.left) document.getElementById('leftDesign').value = design.left;
                if (design.center?.color) document.getElementById('centerColor').value = design.center.color;
                if (design.right) document.getElementById('rightPattern').value = design.right;
            }
        });
    </script>
</body>
</html>
